<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>openFDA • openFDA</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Merriweather-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="openFDA">
<meta name="description" content="Get up and running with accessing openFDA from R.
">
<meta property="og:description" content="Get up and running with accessing openFDA from R.
">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">openFDA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/openFDA.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/using_openFDA.html">Extracting FDA data with BNF terms</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/simpar1471/openFDA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>openFDA</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/simpar1471/openFDA/blob/main/vignettes/openFDA.Rmd" class="external-link"><code>vignettes/openFDA.Rmd</code></a></small>
      <div class="d-none name"><code>openFDA.Rmd</code></div>
    </div>

    
    
<p>Using openFDA can be a breeze, if you know how to construct good
queries. This short guide will get you started with
<a href="https://github.com/simpar1471/openFDA" class="external-link">openFDA</a>, and show you how to put together more
complicated queries. We start by loading openFDA.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/simpar1471/openFDA" class="external-link">openFDA</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="the-openfda-api">The openFDA API<a class="anchor" aria-label="anchor" href="#the-openfda-api"></a>
</h2>
<p>The openFDA API makes public FDA data available from a simple, public
API. Users of this API have access to FDA data on food, human and
veterinary drugs, devices, and more. You can read all about it at their
<a href="https://open.fda.gov/" class="external-link">website</a>. The API limits results sets
to 1000 records. To access over 1000 results, you’d usually need to
manually submit multiple requests which skip past larger and larger
chunks of the dataset (<a href="https://open.fda.gov/apis/paging/" class="external-link">see
online for more info</a>).</p>
<p>With this package, however, that can be handled for you. By default,
<code><a href="../reference/openFDA.html">openFDA()</a></code> will ask you if you want to retrieve all possible
results. However, asking for user input isn’t possible when in a
vignette. Additionally, we don’t want to do paging for these examples,
as our searches get lots of results. Therefore, to prevent paging, we
set the package-level option <code>openFDA.paging</code> to
<code>"no"</code>. Now <code><a href="../reference/openFDA.html">openFDA()</a></code> will automatically
<strong>not</strong> perform paging, even when it’s possible.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"openFDA.paging"</span> <span class="op">=</span> <span class="st">"no-quiet"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-simple-openfda-query">A simple openFDA query<a class="anchor" aria-label="anchor" href="#a-simple-openfda-query"></a>
</h2>
<p>The simplest way to query the openFDA API is to identify the
<strong>endpoint</strong> you want to use and provide other search
terms. For example, this snippet retrieves 2 records about
<strong>adverse events</strong> in the <strong>drugs</strong> endpoint.
The empty search string (<code>""</code>) means the results will be
non-specific.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">search</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/openFDA.html">openFDA</a></span><span class="op">(</span>search <span class="op">=</span> <span class="st">""</span>,</span>
<span>                  endpoint <span class="op">=</span> <span class="st">"drug-event"</span>,</span>
<span>                  limit <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                  paging <span class="op">=</span> <span class="st">"no"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> openFDA returned more results (19028302) than your `limit` (2).</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> With 2 results per page, pagination will require 9,514,151 queries to</span></span>
<span><span class="co">#&gt;   retrieve all of these results. This will take at least 11h 43s.</span></span>
<span><span class="va">search</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">&lt;httr2_response&gt;</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">GET</span> https://api.fda.gov/drug/event.json?search=&amp;limit=2</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Status</span>: 200 OK</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Content-Type</span>: application/json</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Body</span>: In memory (3923 bytes)</span></span></code></pre></div>
<p>The warning given about pagination is because we searched on the
whole dataset, but used <code>limit</code> to only pull out the first
two results. We can suppress this warning by setting <code>paging</code>
to <code>"no-quiet"</code>. This ensures you don’t page the whole
dataset (which would take eleven hours) and suppresses the warning:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">search</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/openFDA.html">openFDA</a></span><span class="op">(</span>search <span class="op">=</span> <span class="st">""</span>,</span>
<span>                  endpoint <span class="op">=</span> <span class="st">"drug-event"</span>,</span>
<span>                  limit <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                  paging <span class="op">=</span> <span class="st">"no-quiet"</span><span class="op">)</span></span>
<span><span class="va">search</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">&lt;httr2_response&gt;</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">GET</span> https://api.fda.gov/drug/event.json?search=&amp;limit=2</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Status</span>: 200 OK</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Content-Type</span>: application/json</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Body</span>: In memory (3923 bytes)</span></span></code></pre></div>
<div class="section level3">
<h3 id="openfda-results">openFDA results<a class="anchor" aria-label="anchor" href="#openfda-results"></a>
</h3>
<p>The function returns an <a href="https://httr2.r-lib.org" class="external-link">httr2</a> response object, with
attached JSON data. We use <code><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">httr2::resp_body_json()</a></code> to
extract the underlying data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">json</span> <span class="op">&lt;-</span> <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="va">search</span><span class="op">)</span></span></code></pre></div>
<p>If you don’t specify a field to <code>count</code> on, the JSON data
has two sections - <code>meta</code> and <code>results</code>.</p>
<div class="section level4">
<h4 id="meta">Meta<a class="anchor" aria-label="anchor" href="#meta"></a>
</h4>
<p>The <code>meta</code> section has important metadata on your results,
which includes:</p>
<ul>
<li>
<code>disclaimer</code> - An important disclaimer regarding the data
provided by openFDA.</li>
<li>
<code>license</code> - A webpage with license terms that govern the
openFDA API.</li>
<li>
<code>last_updated</code> - The last date at which this openFDA
endpoint was updated.</li>
<li>
<code>results.skip</code> - How many results were skipped? Set by
the <code>skip</code> parameter in <code><a href="../reference/openFDA.html">openFDA()</a></code>.</li>
<li>
<code>results.limit</code> - How many results were retrieved? Set by
the <code>limit</code> parameter in <code><a href="../reference/openFDA.html">openFDA()</a></code>.</li>
<li>
<code>results.total</code> - How many results were there in total
matching your <code>search</code> criteria?</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">json</span><span class="op">$</span><span class="va">meta</span></span>
<span><span class="co">#&gt; $disclaimer</span></span>
<span><span class="co">#&gt; [1] "Do not rely on openFDA to make decisions regarding medical care. While we make every effort to ensure that data is accurate, you should assume all results are unvalidated. We may limit or otherwise restrict your access to the API in line with our Terms of Service."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $terms</span></span>
<span><span class="co">#&gt; [1] "https://open.fda.gov/terms/"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $license</span></span>
<span><span class="co">#&gt; [1] "https://open.fda.gov/license/"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $last_updated</span></span>
<span><span class="co">#&gt; [1] "2025-04-28"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $results</span></span>
<span><span class="co">#&gt; $results$skip</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $results$limit</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $results$total</span></span>
<span><span class="co">#&gt; [1] 19028302</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h4>
<p>For non-<code>count</code> queries, this will be a set of records
which were found in the endpoint and match your <code>search</code>
term.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">json</span><span class="op">$</span><span class="va">results</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [[1]]$safetyreportid</span></span>
<span><span class="co">#&gt; [1] "5801206-7"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$transmissiondateformat</span></span>
<span><span class="co">#&gt; [1] "102"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$transmissiondate</span></span>
<span><span class="co">#&gt; [1] "20090109"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="va">....</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="results-when-count-ing">Results when <code>count</code>-ing<a class="anchor" aria-label="anchor" href="#results-when-count-ing"></a>
</h4>
<p>If you set the <code>count</code> query, then the openFDA API will
not return full records. Instead, it will count the number of records
for each member in the openFDA field you specified for
<code>count</code>. For example, let’s look at drug manufacturers in the
<a href="https://open.fda.gov/apis/drug/drugsfda/" class="external-link">Drugs@FDA
endpoint</a> for <code>"paracetamol"</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/openFDA.html">openFDA</a></span><span class="op">(</span>search <span class="op">=</span> <span class="st">"openfda.generic_name:ketamine"</span>,</span>
<span>                 endpoint <span class="op">=</span> <span class="st">"drug-drugsfda"</span>,</span>
<span>                 count <span class="op">=</span> <span class="st">"openfda.manufacturer_name.exact"</span>,</span>
<span>                 paging <span class="op">=</span> <span class="st">"no"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">count</span><span class="op">$</span><span class="va">results</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [[1]]$term</span></span>
<span><span class="co">#&gt; [1] "Civica, Inc."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$count</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [[2]]$term</span></span>
<span><span class="va">....</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="using-count-to-make-a-time-series">Using <code>count</code> to make a time series<a class="anchor" aria-label="anchor" href="#using-count-to-make-a-time-series"></a>
</h4>
<p>You can count on fields with a date to create a time series. This is
demonstrated on the <a href="https://open.fda.gov/apis/timeseries/" class="external-link">openFDA website</a>, where
they count the number of received records per day in the
<code>drug/event</code> endpoint. With the openFDA package, you could do
it in R like this:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/openFDA.html">openFDA</a></span><span class="op">(</span>endpoint <span class="op">=</span> <span class="st">"drug-event"</span>, count <span class="op">=</span> <span class="st">"receiptdate"</span><span class="op">)</span></span>
<span><span class="co"># Extract the counts from the response as a data frame</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="va">resp</span>, simplifyDataFrame <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="st">"results"</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date.character</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">time</span>, format <span class="op">=</span> <span class="st">"%Y%m%d"</span><span class="op">)</span></span>
<span><span class="co"># Sort on date column</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co"># Restrict to data from 2000 to 2019</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">date</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2019-01-01"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>                     <span class="va">data</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2019-12-31"</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">date</span>, y <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">count</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Date"</span>, ylab <span class="op">=</span> <span class="st">"Number of adverse events reported"</span><span class="op">)</span></span></code></pre></div>
<p><img src="openFDA_files/figure-html/example_4b_count_timeseries-1.png" alt="A scatter plot of date (on x axis) against number of adverse events reported to the FDA (y-axis)." width="700"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="using-search-terms">Using search terms<a class="anchor" aria-label="anchor" href="#using-search-terms"></a>
</h2>
<p>We can increase the complexity of our query using the
<code>search</code> parameter, which lets us search against specific
openFDA API fields. These fields are harmonised to different degrees in
each API, which you will need to check <a href="https://open.fda.gov/apis/openfda-fields/" class="external-link">online</a>.</p>
<div class="section level3">
<h3 id="searching-on-one-field">Searching on one field<a class="anchor" aria-label="anchor" href="#searching-on-one-field"></a>
</h3>
<p>You can provide search strategies to <code><a href="../reference/openFDA.html">openFDA()</a></code> as single
strings. They are constructed as <code>[FIELD_NAME]:[STRING]</code>,
where <code>FIELD_NAME</code> is the openFDA field you want to search
on. If your <code>STRING</code> contains spaces, you must surround it
with double quotes, or openFDA will search against each word in the
string. So, for example, a search for drugs with the class
<code>"thiazide diuretic"</code> should be formatted as
<code>"openfda.pharm_class_epc:\"thiazide diuretic\""</code>, or the API
will collect all drugs which have the words <code>"thiazide"</code> or
<code>"diuretic"</code> in their established pharmacological class
(EPC).</p>
<p>Note that there are helpers in the package
(i.e. <code>construct_search_term()</code>) for assembling search terms;
they are discussed below.</p>
<p>Let’s do an unrefined search first:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">search_unrefined</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/openFDA.html">openFDA</a></span><span class="op">(</span></span>
<span>  search <span class="op">=</span> <span class="st">"openfda.pharm_class_epc:thiazide diuretic"</span>,</span>
<span>  endpoint <span class="op">=</span> <span class="st">"drug-drugsfda"</span>,</span>
<span>  limit <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  paging <span class="op">=</span> <span class="st">"no-quiet"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="va">search_unrefined</span><span class="op">)</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">total</span></span>
<span><span class="co">#&gt; [1] 224</span></span></code></pre></div>
<p>Let’s compare this to our refined search, where we add double-quotes
around the search term:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">search_refined</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/openFDA.html">openFDA</a></span><span class="op">(</span></span>
<span>  search <span class="op">=</span> <span class="st">"openfda.pharm_class_epc:\"thiazide diuretic\""</span>,</span>
<span>  endpoint <span class="op">=</span> <span class="st">"drug-drugsfda"</span>,</span>
<span>  paging <span class="op">=</span> <span class="st">"no-quiet"</span>,</span>
<span>  limit <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="va">search_refined</span><span class="op">)</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">total</span></span>
<span><span class="co">#&gt; [1] 123</span></span></code></pre></div>
<p>As you can see, the unrefined search picked up 101 more results, most
of which would have probably been non-thiazide diuretics.</p>
</div>
<div class="section level3">
<h3 id="searching-on-multiple-fields">Searching on multiple fields<a class="anchor" aria-label="anchor" href="#searching-on-multiple-fields"></a>
</h3>
<p>The openFDA API also lets you search on various fields at once, to
construct increasingly more specific queries. You can either write your
own complex search queries, or let the package do (some of) the heavier
lifting for you.</p>
<div class="section level4">
<h4 id="write-your-own-search-term">Write your own search term<a class="anchor" aria-label="anchor" href="#write-your-own-search-term"></a>
</h4>
<p>Using the guides on the <a href="https://open.fda.gov/apis/query-parameters/" class="external-link">openFDA website</a>,
you can put together your own query. For example, the following query
looks for up to 5 records which were submitted by Walmart and are taken
orally. We can use <a href="https://purrr.tidyverse.org/" class="external-link">purrr</a> functions to extract a brand
name for each record. Note that though a single record can have multiple
brand names, we are choosing to only extract the first one.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">search_term</span> <span class="op">&lt;-</span> <span class="st">"openfda.manufacturer_name:Walmart+AND+openfda.route=oral"</span></span>
<span><span class="va">search</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/openFDA.html">openFDA</a></span><span class="op">(</span>search <span class="op">=</span> <span class="va">search_term</span>,</span>
<span>                  endpoint <span class="op">=</span> <span class="st">"drug-drugsfda"</span>,</span>
<span>                  paging <span class="op">=</span> <span class="st">"no-quiet"</span>,</span>
<span>                  limit <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">json</span> <span class="op">&lt;-</span> <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="va">search</span><span class="op">)</span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">json</span><span class="op">$</span><span class="va">results</span>, .f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"openfda"</span>, <span class="st">"brand_name"</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "OMEPRAZOLE"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] "BASIC CARE LANSOPRAZOLE"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] "FEXOFENADINE HCL AND PSEUDOEPHEDRINE HCI"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] "ALL DAY ALLERGY"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [1] "PURELAX"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="let-openfda-construct-the-search-term">Let <code>openFDA()</code> construct the search term<a class="anchor" aria-label="anchor" href="#let-openfda-construct-the-search-term"></a>
</h4>
<p>In <code><a href="../reference/openFDA.html">openFDA()</a></code>, you can provide a named character vector
with many field/search term pairs to the <code>search</code> parameter.
The function will automatically add double quotes (<code>""</code>)
around your search terms, if you’re providing field/value pairs like
this.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">search</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/openFDA.html">openFDA</a></span><span class="op">(</span>search <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"openfda.generic_name"</span> <span class="op">=</span> <span class="st">"amoxicillin"</span><span class="op">)</span>,</span>
<span>                  endpoint <span class="op">=</span> <span class="st">"drug-drugsfda"</span>,</span>
<span>                  limit <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                  paging <span class="op">=</span> <span class="st">"no-quiet"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Number of results:"</span>, <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="va">search</span><span class="op">)</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">total</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Number of results: 54"</span></span></code></pre></div>
<p>You can include as many fields as you like, as long as you only
provide each field once. By default, the terms are combined with an
<code>OR</code> operator in <code><a href="../reference/openFDA.html">openFDA()</a></code>. The below search
strategy will therefore pick up all entries in <a href="https://open.fda.gov/apis/drug/drugsfda/" class="external-link">Drugs@FDA</a> which are
taken by mouth.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">search</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/openFDA.html">openFDA</a></span><span class="op">(</span>search <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"openfda.generic_name"</span> <span class="op">=</span> <span class="st">"amoxicillin"</span>,</span>
<span>                             <span class="st">"openfda.route"</span> <span class="op">=</span> <span class="st">"oral"</span><span class="op">)</span>,</span>
<span>                  endpoint <span class="op">=</span> <span class="st">"drug-drugsfda"</span>,</span>
<span>                  limit <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                  paging <span class="op">=</span> <span class="st">"no-quiet"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Number of results:"</span>, <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="va">search</span><span class="op">)</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">total</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Number of results: 7008"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="pre-construct-a-search-term">Pre-construct a search term<a class="anchor" aria-label="anchor" href="#pre-construct-a-search-term"></a>
</h4>
<p>You can use <code><a href="../reference/format_search_term.html">format_search_term()</a></code> to pre-generate strings
to pass to <code><a href="../reference/openFDA.html">openFDA()</a></code> as <code>search</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/format_search_term.html">format_search_term</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"openfda.generic_name"</span> <span class="op">=</span> <span class="st">"amoxicillin"</span>, <span class="st">"openfda.route"</span> <span class="op">=</span> <span class="st">"oral"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "openfda.generic_name:%22amoxicillin%22+openfda.route:%22oral%22"</span></span></code></pre></div>
<p>Sometimes you will want to combine multiple search terms with
<code>AND</code> operators. To do this, set the <code>mode</code>
argument to <code>"and"</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">search_term</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_search_term.html">format_search_term</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"openfda.generic_name"</span> <span class="op">=</span> <span class="st">"amoxicillin"</span>, <span class="st">"openfda.route"</span> <span class="op">=</span> <span class="st">"oral"</span><span class="op">)</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"and"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">search_term</span></span>
<span><span class="co">#&gt; [1] "openfda.generic_name:%22amoxicillin%22+AND+openfda.route:%22oral%22"</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">search</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/openFDA.html">openFDA</a></span><span class="op">(</span>search <span class="op">=</span> <span class="va">search_term</span>,</span>
<span>                  endpoint <span class="op">=</span> <span class="st">"drug-drugsfda"</span>,</span>
<span>                  limit <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                  paging <span class="op">=</span> <span class="st">"no-quiet"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Number of results:"</span>, <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="va">search</span><span class="op">)</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">total</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Number of results: 51"</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="wildcards">Wildcards<a class="anchor" aria-label="anchor" href="#wildcards"></a>
</h3>
<p>You can use the wildcard character <code>"*"</code> to match zero or
more characters. For example, we could take the prototypical ending to a
common drug class - e.g. the <strong>sartans</strong>, which are
angiotensin-II receptor blockers - and see which manufacturers are most
represented in <a href="mailto:Drugs@FDA" class="email">Drugs@FDA</a>
for this class. When using wildcards, either pre-format the string
yourself <em>without double-quotes</em> or use
<code><a href="../reference/format_search_term.html">format_search_term()</a></code> with <code>exact = FALSE</code>. If
you try to search with both double-quotes and the wildcard character,
you will get a 404 error from openFDA.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">search_term</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_search_term.html">format_search_term</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"openfda.generic_name"</span> <span class="op">=</span> <span class="st">"*sartan"</span><span class="op">)</span>,</span>
<span>                                  exact <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">search</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/openFDA.html">openFDA</a></span><span class="op">(</span>search <span class="op">=</span> <span class="va">search_term</span>,</span>
<span>                  count <span class="op">=</span> <span class="st">"openfda.manufacturer_name.exact"</span>,</span>
<span>                  endpoint <span class="op">=</span> <span class="st">"drug-drugsfda"</span>,</span>
<span>                  paging <span class="op">=</span> <span class="st">"yes"</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="va">search</span>, simplifyDataFrame <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="st">"results"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                    term count</span></span>
<span><span class="co">#&gt; 1       Alembic Pharmaceuticals Limited    15</span></span>
<span><span class="co">#&gt; 2      Macleods Pharmaceuticals Limited    15</span></span>
<span><span class="co">#&gt; 3          Alembic Pharmaceuticals Inc.    14</span></span>
<span><span class="co">#&gt; 4              Aurobindo Pharma Limited    13</span></span>
<span><span class="co">#&gt; 5           Lupin Pharmaceuticals, Inc.    10</span></span>
<span><span class="co">#&gt; 6            Mylan Pharmaceuticals Inc.     7</span></span>
<span><span class="co">#&gt; 7              Solco Healthcare US, LLC     7</span></span>
<span><span class="co">#&gt; 8              Ascend Laboratories, LLC     6</span></span>
<span><span class="co">#&gt; 9          Camber Pharmaceuticals, Inc.     6</span></span>
<span><span class="co">#&gt; 10 Novartis Pharmaceuticals Corporation     6</span></span></code></pre></div>
<p>It looks like <code>"Alembic Pharmaceuticals"</code> is very active
in this space - interesting!</p>
</div>
</div>
<div class="section level2">
<h2 id="large-result-sets">Large result sets<a class="anchor" aria-label="anchor" href="#large-result-sets"></a>
</h2>
<p>The openFDA API only returns up to 1000 results at one time. To
return a results set larger than 1000 records, a basic paging system is
implemented. On a per-call basis, this is controlled by the
<code>paging</code> parameter in <code><a href="../reference/openFDA.html">openFDA()</a></code>. To change this
behaviour for the duration of an R session, edit the option
<code>"openFDA.paging"</code>, as demonstrated above.</p>
<p>This argument must take one of these values:</p>
<ul>
<li>
<code>"ask"</code> (default; only valid if R is running
interactively) - ask before performing paging</li>
<li>
<code>"yes"</code> - always perform paging where necessary, but
print a message to the console</li>
<li>
<code>"yes-quiet"</code> - always perform paging where necessary,
but don’t print a message to the console</li>
<li>
<code>"no"</code> - never perform paging, but print a message to the
console</li>
<li>
<code>"no-quiet"</code> - never perform paging, but don’t print a
message to the console</li>
</ul>
<p>When paging is performed, <code><a href="../reference/openFDA.html">openFDA()</a></code> returns a list of
<a href="https://httr2.r-lib.org" class="external-link">httr2</a> response objects, instead of a single response:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/openFDA.html">openFDA</a></span><span class="op">(</span>search <span class="op">=</span> <span class="st">"openfda.manufacturer_name:Pharma"</span>,</span>
<span>                 limit <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                 endpoint <span class="op">=</span> <span class="st">"drug-drugsfda"</span>,</span>
<span>                 paging <span class="op">=</span> <span class="st">"yes"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> openFDA returned more results (1987) than your `limit` (500).</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> With 500 results per page, pagination will require 4 queries to retrieve all</span></span>
<span><span class="co">#&gt;   of these results. This will take at least 1s.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="other-openfda-api-features">Other openFDA API features<a class="anchor" aria-label="anchor" href="#other-openfda-api-features"></a>
</h2>
<p>This short guide does not cover all aspects of openFDA. It is
recommended that you go to the <a href="https://open.fda.gov/apis/" class="external-link">openFDA API website</a> and check out
the resources there to see information on:</p>
<ul>
<li><a href="https://open.fda.gov/apis/dates-and-ranges/" class="external-link">Date ands
ranges</a></li>
<li><a href="https://open.fda.gov/apis/missing-values/" class="external-link">Search for
fields with missing values</a></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Simon Parker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
