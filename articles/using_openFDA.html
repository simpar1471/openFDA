<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Extracting FDA data with BNF terms • openFDA</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Merriweather-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extracting FDA data with BNF terms">
<meta name="description" content="Using openFDA to retrieve lists of drugs based on BNF generic drug terms.
">
<meta property="og:description" content="Using openFDA to retrieve lists of drugs based on BNF generic drug terms.
">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">openFDA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/openFDA.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/using_openFDA.html">Extracting FDA data with BNF terms</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/simpar1471/openFDA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Extracting FDA data with BNF terms</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/simpar1471/openFDA/blob/main/vignettes/articles/using_openFDA.Rmd" class="external-link"><code>vignettes/articles/using_openFDA.Rmd</code></a></small>
      <div class="d-none name"><code>using_openFDA.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Let’s start by loading the package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/simpar1471/openFDA" class="external-link">openFDA</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-brand-names-and-epcs-from-generic-bnf-terms">Get brand names and EPCs from generic BNF terms<a class="anchor" aria-label="anchor" href="#get-brand-names-and-epcs-from-generic-bnf-terms"></a>
</h2>
<p>First, we’ll use <code><a href="../reference/openFDA.html">openFDA()</a></code> to retrieve brand names for
the drugs we are interested in from the BNF. We first initialise a
vector of drug names from the BNF.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bnf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"captopril"</span>, <span class="st">"enalapril"</span>, <span class="st">"fosinopril"</span>, <span class="st">"imidapril"</span>, <span class="st">"lisinopril"</span>,</span>
<span>         <span class="st">"perindopril"</span>, <span class="st">"quinapril"</span>, <span class="st">"ramipril"</span>, <span class="st">"trandolapril"</span>,</span>
<span></span>
<span>         <span class="st">"amlodipine"</span>, <span class="st">"diltiazem"</span>, <span class="st">"felodipine"</span>, <span class="st">"lacidipine"</span>, <span class="st">"lercanidipine"</span>,</span>
<span>         <span class="st">"nicardipine"</span>, <span class="st">"nifedipine"</span>, <span class="st">"nimodipine"</span>, <span class="st">"verapamil"</span>,</span>
<span></span>
<span>         <span class="st">"azilsartan"</span>, <span class="st">"candesartan"</span>, <span class="st">"eprosartan"</span>, <span class="st">"irbesartan"</span>,</span>
<span>         <span class="st">"losartan"</span>, <span class="st">"olmesartan"</span>, <span class="st">"telmisartan"</span>, <span class="st">"valsartan"</span>,</span>
<span></span>
<span>         <span class="st">"bumetanide"</span>, <span class="st">"bendroflumethiazide"</span>, <span class="st">"chlortalidone"</span>,</span>
<span></span>
<span>         <span class="st">"hydrochlorothiazide"</span>, <span class="st">"indapamide"</span>,</span>
<span></span>
<span>         <span class="st">"atorvastatin"</span>, <span class="st">"fluvastatin"</span>,</span>
<span>         <span class="st">"pravastatin"</span>, <span class="st">"rosuvastatin"</span>, <span class="st">"simvastatin"</span>,</span>
<span></span>
<span>         <span class="st">"ezetimibe"</span>,</span>
<span></span>
<span>         <span class="st">"alirocumab"</span>, <span class="st">"evolocumab"</span>,</span>
<span></span>
<span>         <span class="st">"metformin"</span>,</span>
<span></span>
<span>         <span class="st">"gliclazide"</span>, <span class="st">"glimepiride"</span>, <span class="st">"tolbutamide"</span>, <span class="st">"glipizide"</span>,</span>
<span></span>
<span>         <span class="st">"alogliptin"</span>, <span class="st">"linagliptin"</span>, <span class="st">"saxagliptin"</span>, <span class="st">"sitagliptin"</span>,</span>
<span>         <span class="st">"vildagliptin"</span>,</span>
<span></span>
<span>         <span class="st">"canagliflozin"</span>, <span class="st">"dapagliflozin"</span>, <span class="st">"empagliflozin"</span>, <span class="st">"ertugliflozin"</span>,</span>
<span></span>
<span>         <span class="st">"dulaglutide"</span>, <span class="st">"exenatide"</span>, <span class="st">"liraglutide"</span>, <span class="st">"lixisenatide"</span>,</span>
<span>         <span class="st">"semaglutide"</span>,</span>
<span></span>
<span>         <span class="st">"pioglitazone"</span><span class="op">)</span></span></code></pre></div>
<p>We can then paste these into a single search string, and use them to
search against the <code>"openfda.generic_name"</code> field in the <a href="https://open.fda.gov/apis/drug/drugsfda/" class="external-link">Drugs@FDA
endpoint</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bnf_search_term</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_search_term.html">format_search_term</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"openfda.generic_name"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">bnf</span>, collapse <span class="op">=</span> <span class="st">"+"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  exact <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">bnf_search</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/openFDA.html">openFDA</a></span><span class="op">(</span>search <span class="op">=</span> <span class="va">bnf_search_term</span>, endpoint <span class="op">=</span> <span class="st">"drug-drugsfda"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bnf_search_json</span> <span class="op">&lt;-</span> <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="va">bnf_search</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The JSON object contains information including the generic and brand names </span></span>
<span><span class="va">bnf_search_json</span><span class="op">$</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [[1]]$product_number</span></span>
<span><span class="co">#&gt; [1] "003"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$reference_drug</span></span>
<span><span class="co">#&gt; [1] "No"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$brand_name</span></span>
<span><span class="co">#&gt; [1] "FOSINOPRIL SODIUM"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$active_ingredients</span></span>
<span><span class="co">#&gt; [[1]]$active_ingredients[[1]]</span></span>
<span><span class="co">#&gt; [[1]]$active_ingredients[[1]]$name</span></span>
<span><span class="co">#&gt; [1] "FOSINOPRIL SODIUM"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$active_ingredients[[1]]$strength</span></span>
<span><span class="co">#&gt; [1] "40MG"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$reference_standard</span></span>
<span><span class="co">#&gt; [1] "No"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$dosage_form</span></span>
<span><span class="co">#&gt; [1] "TABLET"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$route</span></span>
<span><span class="co">#&gt; [1] "ORAL"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$marketing_status</span></span>
<span><span class="co">#&gt; [1] "Discontinued"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [[2]]$product_number</span></span>
<span><span class="co">#&gt; [1] "001"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$reference_drug</span></span>
<span><span class="co">#&gt; [1] "No"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$brand_name</span></span>
<span><span class="co">#&gt; [1] "FOSINOPRIL SODIUM"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$active_ingredients</span></span>
<span><span class="co">#&gt; [[2]]$active_ingredients[[1]]</span></span>
<span><span class="co">#&gt; [[2]]$active_ingredients[[1]]$name</span></span>
<span><span class="co">#&gt; [1] "FOSINOPRIL SODIUM"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$active_ingredients[[1]]$strength</span></span>
<span><span class="co">#&gt; [1] "10MG"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$reference_standard</span></span>
<span><span class="co">#&gt; [1] "No"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$dosage_form</span></span>
<span><span class="co">#&gt; [1] "TABLET"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$route</span></span>
<span><span class="co">#&gt; [1] "ORAL"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$marketing_status</span></span>
<span><span class="co">#&gt; [1] "Discontinued"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [[3]]$product_number</span></span>
<span><span class="co">#&gt; [1] "002"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$reference_drug</span></span>
<span><span class="co">#&gt; [1] "No"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$brand_name</span></span>
<span><span class="co">#&gt; [1] "FOSINOPRIL SODIUM"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$active_ingredients</span></span>
<span><span class="co">#&gt; [[3]]$active_ingredients[[1]]</span></span>
<span><span class="co">#&gt; [[3]]$active_ingredients[[1]]$name</span></span>
<span><span class="co">#&gt; [1] "FOSINOPRIL SODIUM"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$active_ingredients[[1]]$strength</span></span>
<span><span class="co">#&gt; [1] "20MG"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$reference_standard</span></span>
<span><span class="co">#&gt; [1] "No"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$dosage_form</span></span>
<span><span class="co">#&gt; [1] "TABLET"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$route</span></span>
<span><span class="co">#&gt; [1] "ORAL"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$marketing_status</span></span>
<span><span class="co">#&gt; [1] "Discontinued"</span></span></code></pre></div>
<div class="section level3">
<h3 id="extracting-openfda-fields-programmatically">Extracting openFDA fields programmatically<a class="anchor" aria-label="anchor" href="#extracting-openfda-fields-programmatically"></a>
</h3>
<p>The JSON data from <code><a href="../reference/openFDA.html">openFDA()</a></code> is useful, and can be
easily parsed with tools from <a href="https://purrr.tidyverse.org/" class="external-link">purrr</a> and
<a href="https://vctrs.r-lib.org/" class="external-link">vctrs</a>. The following function dips into the JSON data
from <code><a href="../reference/openFDA.html">openFDA()</a></code> and pulls out data from specific fields. It
extracts all occurrences of data within the requested field, then
condenses these down into a single character vector.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Extract openFDA field data from openFDA JSON objects</span></span>
<span><span class="co">#' @param json</span></span>
<span><span class="co">#' @param openFDA_field A single string denoting an openFDA field to extract.</span></span>
<span><span class="co">#'   Should be a valid field name, e.g. `"openfda.generic_name"` or </span></span>
<span><span class="co">#'   `"openfda.pharm_class_moa"`.</span></span>
<span><span class="co">#' @returns A character vector with all unique values of `openfda_field` for </span></span>
<span><span class="co">#'   your given search.</span></span>
<span><span class="va">extract_openFDA_field</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">json</span>, <span class="va">openfda_field</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">json</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="st">"results"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>.f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"openfda"</span>, <span class="va">openfda_field</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">vctrs</span><span class="fu">::</span><span class="fu"><a href="https://vctrs.r-lib.org/reference/list_drop_empty.html" class="external-link">list_drop_empty</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level4">
<h4 id="brand-names">Brand names<a class="anchor" aria-label="anchor" href="#brand-names"></a>
</h4>
<p>Now that we have our function for data extraction, we can pull out
the brand names associated with the generic drugs we queried against the
API above.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openFDA_brand_names</span> <span class="op">&lt;-</span> <span class="fu">extract_openFDA_field</span><span class="op">(</span><span class="va">bnf_search_json</span>, <span class="st">"brand_name"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">openFDA_brand_names</span><span class="op">[</span><span class="fl">25</span><span class="op">:</span><span class="fl">30</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ENALAPRIL MALEATE"          "VASOTEC"                   </span></span>
<span><span class="co">#&gt; [3] "TELMISARTAN AND AMLODIPINE" "NORVASC"                   </span></span>
<span><span class="co">#&gt; [5] "AMLODIPINE BESYLATE"        "FELODIPINE"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="established-pharmacological-classes">Established pharmacological classes<a class="anchor" aria-label="anchor" href="#established-pharmacological-classes"></a>
</h4>
<p>We’ll also extract the established pharmacological classes (EPCs) of
our drugs. We will use these EPCs as their own query term below, to find
generic drugs which were not within our BNF drug list.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openfda_EPCs</span> <span class="op">&lt;-</span> <span class="fu">extract_openFDA_field</span><span class="op">(</span><span class="va">bnf_search_json</span>, <span class="st">"pharm_class_epc"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>brand_names <span class="op">=</span> <span class="va">openFDA_brand_names</span>, </span>
<span>             EPCs <span class="op">=</span> <span class="va">openfda_EPCs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; brand_names        EPCs </span></span>
<span><span class="co">#&gt;         172          20</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="query-openfda-with-epcs">Query openFDA with EPCs<a class="anchor" aria-label="anchor" href="#query-openfda-with-epcs"></a>
</h2>
<p>We can use EPCs to run queries against the openFDA API. We do this by
removing the <code>"[EPC]"</code> tags from our retrieved data, then
supplying them in the <code>search</code> strategy.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openfda_EPCs</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="va">openfda_EPCs</span>, pattern <span class="op">=</span> <span class="st">" \\[.*\\]"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">openfda_EPCs</span></span>
<span><span class="co">#&gt;  [1] "Thiazide Diuretic"                             </span></span>
<span><span class="co">#&gt;  [2] "HMG-CoA Reductase Inhibitor"                   </span></span>
<span><span class="co">#&gt;  [3] "Angiotensin 2 Receptor Blocker"                </span></span>
<span><span class="co">#&gt;  [4] "Dietary Cholesterol Absorption Inhibitor"      </span></span>
<span><span class="co">#&gt;  [5] "Loop Diuretic"                                 </span></span>
<span><span class="co">#&gt;  [6] "Dihydropyridine Calcium Channel Blocker"       </span></span>
<span><span class="co">#&gt;  [7] "Dipeptidyl Peptidase 4 Inhibitor"              </span></span>
<span><span class="co">#&gt;  [8] "Thiazide-like Diuretic"                        </span></span>
<span><span class="co">#&gt;  [9] "Angiotensin Converting Enzyme Inhibitor"       </span></span>
<span><span class="co">#&gt; [10] "GLP-1 Receptor Agonist"                        </span></span>
<span><span class="co">#&gt; [11] "Sodium-Glucose Cotransporter 2 Inhibitor"      </span></span>
<span><span class="co">#&gt; [12] "Sulfonylurea"                                  </span></span>
<span><span class="co">#&gt; [13] "Potassium-sparing Diuretic"                    </span></span>
<span><span class="co">#&gt; [14] "Calcium Channel Blocker"                       </span></span>
<span><span class="co">#&gt; [15] "Aldosterone Antagonist"                        </span></span>
<span><span class="co">#&gt; [16] "Peroxisome Proliferator Receptor alpha Agonist"</span></span>
<span><span class="co">#&gt; [17] "Peroxisome Proliferator Receptor gamma Agonist"</span></span>
<span><span class="co">#&gt; [18] "Thiazolidinedione"                             </span></span>
<span><span class="co">#&gt; [19] "Insulin Analog"                                </span></span>
<span><span class="co">#&gt; [20] "Adenosine Triphosphate-Citrate Lyase Inhibitor"</span></span></code></pre></div>
<div class="section level3">
<h3 id="query-openfda-with-our-epcs">Query openFDA with our EPCs<a class="anchor" aria-label="anchor" href="#query-openfda-with-our-epcs"></a>
</h3>
<p>Before supplying these strings as search terms to openFDA, we
surround them with double-quotation marks (<code>"</code>). This ensures
openFDA considers each term as a single string, instead of a set of
strings. Without the quotes, a term such as
<code>"Thiazide Diuretic"</code> will be treated as a search for any
drugs with either “Thiazide” or “Diuretic” in the EPC, instead of a
search for specifically thiazide diuretics.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">epc_search</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  .x <span class="op">=</span> <span class="va">openfda_EPCs</span>,</span>
<span>  .f <span class="op">=</span> \<span class="op">(</span><span class="va">epc</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/openFDA.html">openFDA</a></span><span class="op">(</span>search <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"openfda.pharm_class_epc"</span> <span class="op">=</span> <span class="va">epc</span><span class="op">)</span>,</span>
<span>            endpoint <span class="op">=</span> <span class="st">"drug-drugsfda"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">epc_generics</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  .x <span class="op">=</span> <span class="va">epc_search</span>, </span>
<span>  .f <span class="op">=</span> \<span class="op">(</span><span class="va">json</span><span class="op">)</span> <span class="fu">extract_openFDA_field</span><span class="op">(</span><span class="va">json</span>, openfda_field <span class="op">=</span> <span class="st">"generic_name"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu">flatten_chr</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="compare-new-generic-names-to-bnf-terms">Compare new generic names to BNF terms<a class="anchor" aria-label="anchor" href="#compare-new-generic-names-to-bnf-terms"></a>
</h4>
<p>Using some pattern matching, we can see which new generic drug terms
we have retrieved by searching with EPCs.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">bnf_regex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">bnf</span>, collapse <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span></span>
<span><span class="va">epc_generics</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="va">bnf_regex</span>, value <span class="op">=</span> <span class="cn">TRUE</span>, invert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "chlorothiazide"                     "pitavastatin magnesium"            </span></span>
<span><span class="co">#&gt;  [3] "lovastatin"                         "pitavastatin"                      </span></span>
<span><span class="co">#&gt;  [5] "sparsentan"                         "torsemide"                         </span></span>
<span><span class="co">#&gt;  [7] "furosemide"                         "ethacrynic acid"                   </span></span>
<span><span class="co">#&gt;  [9] "furosemide injection 80 mg/ 10 ml"  "isradipine"                        </span></span>
<span><span class="co">#&gt; [11] "nisoldipine"                        "clevidipine"                       </span></span>
<span><span class="co">#&gt; [13] "clevipidine"                        "chlorthalidone"                    </span></span>
<span><span class="co">#&gt; [15] "metolazone"                         "atenolol and chlorthalidone"       </span></span>
<span><span class="co">#&gt; [17] "atenolol and chlorthalidone tablet" "tirzepatide"                       </span></span>
<span><span class="co">#&gt; [19] "bexagliflozin"                      "sotagliflozin"                     </span></span>
<span><span class="co">#&gt; [21] "glyburide"                          "triamterene capsules"              </span></span>
<span><span class="co">#&gt; [23] "triamterene"                        "spironolactone"                    </span></span>
<span><span class="co">#&gt; [25] "carospir"                           "eplerenone"                        </span></span>
<span><span class="co">#&gt; [27] "fenofibrate"                        "fenofibric acid"                   </span></span>
<span><span class="co">#&gt; [29] "gemfibrozil"                        "insulin aspart injection"          </span></span>
<span><span class="co">#&gt; [31] "insulin aspart"                     "insulin glargine"                  </span></span>
<span><span class="co">#&gt; [33] "insulin lispro"                     "insulin detemir"                   </span></span>
<span><span class="co">#&gt; [35] "insulin lispro-aabc"                "insulin glulisine"                 </span></span>
<span><span class="co">#&gt; [37] "water injection"                    "insulin glargine-yfgn"             </span></span>
<span><span class="co">#&gt; [39] "insulin glargine-aglr"              "diluent"                           </span></span>
<span><span class="co">#&gt; [41] "insulin aspart-szjj"                "insulin degludec"                  </span></span>
<span><span class="co">#&gt; [43] "bempedoic acid"</span></span></code></pre></div>
<p>Of these drugs, the following are of interest:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fda_generics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pitavastatin"</span>, <span class="st">"lovastatin"</span>,</span>
<span>                  <span class="st">"chlorothiazide"</span>, </span>
<span>                  <span class="st">"sparsentan"</span>,</span>
<span>                  <span class="st">"nisoldipine"</span>, <span class="st">"isradipine"</span>, <span class="st">"clevidipine"</span>, </span>
<span>                  <span class="st">"glyburide"</span>, <span class="st">"glibenclamide"</span>,</span>
<span>                  <span class="st">"tirzepatide"</span>, </span>
<span>                  <span class="st">"bexagliflozin"</span>, <span class="st">"sotagliflozin"</span>,</span>
<span>                  <span class="st">"chlorthalidone"</span>, <span class="st">"metolazone"</span>, </span>
<span>                  <span class="st">"spironolactone"</span>, <span class="st">"eplerenone"</span>, </span>
<span>                  <span class="st">"bempedoic acid"</span>, <span class="st">"fenofibrate"</span>, <span class="st">"fenofibric acid"</span>,</span>
<span>                  <span class="st">"gemfibrozil"</span><span class="op">)</span></span></code></pre></div>
<p>We can use these generic names of interest to get even more brand
names:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">more_brand_names</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  .x <span class="op">=</span> <span class="va">fda_generics</span>,</span>
<span>  .f <span class="op">=</span> \<span class="op">(</span><span class="va">generic</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/openFDA.html">openFDA</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"openfda.generic_name"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"\""</span>, <span class="va">generic</span>, <span class="st">"\""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">extract_openFDA_field</span><span class="op">(</span>openfda_field <span class="op">=</span> <span class="st">"brand_name"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">fda_generics</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in openFDA(c(openfda.generic_name = paste0("\"", generic, "\""))): The openFDA API returned a 404 error.</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> This indicates that openFDA had no results to return.</span></span>
<span><span class="co">#&gt; This can be due to:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> A restrictive search term. Yours was</span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">"openfda.generic_name:\"\"glibenclamide\"\""</span>.</span></span>
<span></span>
<span><span class="va">more_brand_names</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="co">#&gt; $pitavastatin</span></span>
<span><span class="co">#&gt; [1] "zypitamag"            "pitavastatin calcium" "nikita"              </span></span>
<span><span class="co">#&gt; [4] "livalo"               "pitavastatin"        </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $lovastatin</span></span>
<span><span class="co">#&gt; [1] "lovastatin" "altoprev"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $chlorothiazide</span></span>
<span><span class="co">#&gt; [1] "chlorothiazide"        "chlorothiazide sodium" "diuril"</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="queries-about-angplt3-inhibitors">Queries about ANGPLT3 inhibitors<a class="anchor" aria-label="anchor" href="#queries-about-angplt3-inhibitors"></a>
</h2>
<p>Finally, let’s collect some data on angiopoietin-like 3 (ANGPLT3)
inhibitors, which can be used in familial homozygous hypercholesteremia
in the UK and US.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">evinacumab_search</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/openFDA.html">openFDA</a></span><span class="op">(</span>search <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"openfda.generic_name"</span> <span class="op">=</span> <span class="st">"evinacumab"</span><span class="op">)</span>,</span>
<span>                             endpoint <span class="op">=</span> <span class="st">"drug-drugsfda"</span><span class="op">)</span></span>
<span><span class="va">evinacumab_epc</span> <span class="op">&lt;-</span> <span class="va">evinacumab_search</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">extract_openFDA_field</span><span class="op">(</span><span class="st">"pharm_class_epc"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">" \\[.*\\]"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">agplt3_inhibitors_search</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/openFDA.html">openFDA</a></span><span class="op">(</span></span>
<span>  search <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"openfda.pharm_class_epc"</span> <span class="op">=</span> <span class="va">evinacumab_epc</span><span class="op">)</span>,</span>
<span>  endpoint <span class="op">=</span> <span class="st">"drug-drugsfda"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">agplt3_inhibitors_brands</span> <span class="op">&lt;-</span> <span class="va">agplt3_inhibitors_search</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">extract_openFDA_field</span><span class="op">(</span><span class="st">"brand_name"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">agplt3_inhibitors_generics</span> <span class="op">&lt;-</span> <span class="va">agplt3_inhibitors_search</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">extract_openFDA_field</span><span class="op">(</span><span class="st">"generic_name"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGPLT3-I brands"</span> <span class="op">=</span> <span class="va">agplt3_inhibitors_brands</span>, </span>
<span>  <span class="st">"AGPLT3-I generics"</span> <span class="op">=</span> <span class="va">agplt3_inhibitors_generics</span><span class="op">)</span></span>
<span><span class="co">#&gt;   AGPLT3-I brands AGPLT3-I generics </span></span>
<span><span class="co">#&gt;         "EVKEEZA"      "EVINACUMAB"</span></span></code></pre></div>
<div class="section level3">
<h3 id="session-info">Session info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.1 (2025-06-13)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.2 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] openFDA_0.1.0.9000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] vctrs_0.6.5       cli_3.6.5         knitr_1.50        rlang_1.1.6      </span></span>
<span><span class="co">#&gt;  [5] xfun_0.52         stringi_1.8.7     purrr_1.0.4       textshaping_1.0.1</span></span>
<span><span class="co">#&gt;  [9] jsonlite_2.0.0    glue_1.8.0        backports_1.5.0   htmltools_0.5.8.1</span></span>
<span><span class="co">#&gt; [13] ragg_1.4.0        sass_0.4.10       rappdirs_0.3.3    rmarkdown_2.29   </span></span>
<span><span class="co">#&gt; [17] evaluate_1.0.4    jquerylib_0.1.4   fastmap_1.2.0     yaml_2.3.10      </span></span>
<span><span class="co">#&gt; [21] lifecycle_1.0.4   httr2_1.1.2       stringr_1.5.1     compiler_4.5.1   </span></span>
<span><span class="co">#&gt; [25] fs_1.6.6          systemfonts_1.2.3 digest_0.6.37     R6_2.6.1         </span></span>
<span><span class="co">#&gt; [29] curl_6.4.0        magrittr_2.0.3    bslib_0.9.0       checkmate_2.3.2  </span></span>
<span><span class="co">#&gt; [33] tools_4.5.1       pkgdown_2.1.3     cachem_1.1.0      desc_1.4.3</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Simon Parker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
