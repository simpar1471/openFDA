---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# openFDA

<!-- badges: start -->
[![R-CMD-check](https://github.com/simpar1471/openFDA/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/simpar1471/openFDA/actions/workflows/R-CMD-check.yaml)
[![Project Status: WIP -- Initial development is in progress, but there has not yet been a stable, usable release suitable for the public.](https://www.repostatus.org/badges/latest/wip.svg)](https://www.repostatus.org/#wip)
<!-- badges: end -->

openFDA makes querying the [openFDA API](https://open.fda.gov/apis/) from R a breeze.
The API itself serves publicly available data from the FDA about foods, drugs, devices, and more.
This data includes data such as recall enforcement reports, adverse events, manufacturer details, and - again - even more!
Note that the data on openFDA has not been validated for clinical or production use.

## Installation

You can install the development version of openFDA from GitHub using either 
[pak](https://pak.r-lib.org/) or [devtools](https://devtools.r-lib.org/):

```r
# install.packages("pak")
pak::pkg_install("simpar1471/openFDA")
```

```r
# install.packages("devtools")
devtools::install_github("simpar1471/openFDA")
```

## Using openFDA
```{r load_openFDA}
library(openFDA)
```

The full documentation for the API is online, so look at the [openFDA 
website](https://open.fda.gov/apis/) to get a full feel for the API itself.

The R package lets you query the API directly from R, using [httr2](https://httr2.r-lib.org/)`.

```{r example1_query}
search <- openFDA(
  search = "openfda.generic_name:furosemide",
  limit = 5
)

search
```

The underlying response is JSON data - you can use `httr2::resp_body_json()` to get the JSON data as a nested list, then extract the fields you want.

```{r example2_json}
json <- httr2::resp_body_json(search)

json$results[[1]]$openfda$brand_name
json$results[[1]]$openfda$pharm_class_epc
```

I've found `{purrr}` to be very useful for parsing this data quickly.

```{r example3_purrr}
purrr::map_chr(
  .x = json$results, 
  .f = \(result) purrr::pluck(result, "openfda", "manufacturer_name", 1)
)
```

## Other R packages for openFDA

The [openfda](https://github.com/rOpenHealth/openfda) package from `rOpenHealth` also wraps the openFDA API from R, and is available on GitHub.
It's got a pretty neat structure whereby you build up a query using individual functions for each parameter - though it's my personal preference to keep these as parameters to a single function.
It also makes results available in data frames, which is nice, but I think working with the response object and parsing the underlying JSON yourself permits more powerful interactions with the API.

There is also [FDAopenR](https://github.com/ck2136/FDAopenR/), which I couldn't quite wrap my head around. The package appears to be in working order, though!